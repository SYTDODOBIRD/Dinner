<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>吃什麼?</title>
  <style>
    /* 版本資訊，定位在白色背景容器的右上角 */
    .version {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 14px;
      color: #555;
      opacity: 0.8;
    }
    /* 基本樣式 */
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
      text-align: center;
    }
    .container {
      position: relative;
      max-width: 1000px;
      margin: 0 auto;
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1, h2 {
      color: #333;
      margin-bottom: 20px;
    }
    .meal-input {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      justify-content: center;
    }
    input[type="text"] {
      flex: 1;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }
    button {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
      color: white;
    }
    #addBtn {
      background-color: #4CAF50;
    }
    #addBtn:hover {
      background-color: #45a049;
    }
    .disabled-btn {
      background-color: #aaa !important; 
      color: #fff !important; 
    }
    .active-btn {
      background-color: #4CAF50 !important;
      color: #fff !important;
    }
    .random-button {
      width: 100%;
      margin-bottom: 20px;
      padding: 12px;
      font-size: 18px;
      background-color: #2196F3;
    }
    .random-button:hover {
      background-color: #1976D2;
    }
    .meal-management {
      background-color: #f8f8f8;
      padding: 15px;
      border-radius: 8px;
    }
    /* 設定菜餚清單可捲動，並限定高度只顯示約10行 */
    .meal-list {
      max-height: 400px; /* 桌機版最大高度 */
      overflow-y: auto;
      display: flex;
      justify-content: center;
    }
    /* 行動版設定：螢幕寬度小於768px時 */
    @media (max-width: 768px) {
      .meal-list {
        max-height: 300px; /* 可依實際需求調整 */
      }
    }
    .meal-column {
      display: flex;
      flex-direction: column;
      gap: 8px;
      width: 100%;
    }
    /* 固定菜餚項目高度，方便計算可視行數 */
    .meal-list-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px;
      background-color: white;
      border-radius: 4px;
      cursor: pointer;
      position: relative;
      height: 40px;
    }
    /* 動畫效果 */
    @keyframes slideIn {
      from { transform: translateX(-100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideOut {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(100%); opacity: 0; }
    }
    .slide-in { animation: slideIn 0.5s forwards; }
    .slide-out { animation: slideOut 0.5s forwards; }
    .delete-btn {
      background-color: #f44336;
    }
    .delete-btn:hover {
      background-color: #da190b;
    }
    /* Modal 視窗樣式（抽選結果用） */
    .modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      width: 80%;
      max-width: 400px;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    .close-btn {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 18px;
      cursor: pointer;
      color: #aaa;
    }
    .close-btn:hover {
      color: #000;
    }
    .modal h1 {
      font-size: 24px;
      color: #333;
      margin: 0;
    }
    .modal .meal {
      font-size: 30px;
      font-weight: bold;
      color: #d32f2f;
      margin: 0;
      text-align: center;
    }
    /* 操作選單樣式 */
    .action-menu {
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      background-color: #fff;
      border: 1px solid #ccc;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      display: none;
      z-index: 3000;
      min-width: 300px;
    }
    .action-menu h3 {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 20px;
      color: #333;
    }
    .action-menu .btn-container {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }
    .action-menu .btn-container button {
      flex: 1;
      padding: 8px;
      font-size: 16px;
      border-radius: 4px;
    }
    /* 按鈕樣式（互換取消與隱藏的背景顏色） */
    .action-menu .hide-btn {
      background-color: #4CAF50;
    }
    .action-menu .cancel-btn {
      background-color: #9E9E9E;
    }
    .action-menu .delete-btn {
      background-color: #f44336;
    }
  </style>
</head>
<body>
  <div class="container" id="appContainer">
    <!-- 版本資訊放在白色背景容器的右上角 -->
    <div class="version">Version 1.0</div>
    <!-- 主功能區（主清單） -->
    <div class="main-area" id="mainArea">
      <h1>吃什麼?</h1>
      <div class="meal-input">
        <input type="text" id="newMeal" placeholder="輸入新菜餚" oninput="checkInput()">
        <button id="addBtn" onclick="onAddBtnClick()">新增</button>
      </div>
      <button class="random-button" onclick="pickRandom()">抽!</button>
      <div class="meal-management">
        <h2>菜餚</h2>
        <div class="meal-list" id="mealList">
          <!-- 由 JavaScript 動態產生單一欄位 -->
        </div>
      </div>
    </div>
  </div>

  <!-- Modal 視窗結構（抽選結果） -->
  <div id="mealModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal()">&times;</span>
      <div class="meal" id="modalMeal"></div>
    </div>
  </div>

  <!-- 操作選單 -->
  <div id="actionMenu" class="action-menu">
    <!-- 標題僅顯示菜餚名稱 -->
    <h3 id="actionMenuTitle"></h3>
    <div class="btn-container">
      <button id="toggleHideBtn" class="hide-btn" onclick="">隱藏</button>
      <button class="cancel-btn" onclick="cancelAction()">取消</button>
      <button class="delete-btn" onclick="deleteMeal()">刪除</button>
    </div>
  </div>

  <script>
    // 主清單預設資料（菜餚名稱的陣列）
    let meals = [
      '炒飯',
      '牛肉麵',
      '炸雞',
      '咖哩飯',
      '滷味便當',
      '酸菜白肉面',
      '三寶飯'
    ];
    // 用來記錄隱藏的菜餚名稱
    let hiddenMeals = [];

    // 用來暫存點擊的菜餚 DOM 與名稱
    let currentMealItem = null;
    let currentMealName = null;

    window.onload = function() {
      loadMeals();
      updateMealList();
      checkInput();
    };

    // 載入 localStorage 資料（只針對 meals 與 hiddenMeals）
    function loadMeals() {
      const storedMeals = localStorage.getItem('meals');
      if (storedMeals) {
        meals = JSON.parse(storedMeals);
      }
      const storedHidden = localStorage.getItem('hiddenMeals');
      if (storedHidden) {
        hiddenMeals = JSON.parse(storedHidden);
      }
    }

    // 儲存資料至 localStorage
    function saveMeals() {
      localStorage.setItem('meals', JSON.stringify(meals));
      localStorage.setItem('hiddenMeals', JSON.stringify(hiddenMeals));
    }

    // 新增按鈕點擊：新增菜餚（不自動抽選）
    function onAddBtnClick() {
      const input = document.getElementById('newMeal');
      const meal = input.value.trim();
      
      if (!meal) {
        alert('請先填入新菜餚');
        return;
      }
      if (meals.includes(meal)) {
        alert(`菜餚「${meal}」已存在！`);
        return;
      }
      
      meals.push(meal);
      saveMeals();
      input.value = '';
      updateMealList(meal);
      alert(`成功新增「${meal}」！`);
      checkInput();
    }

    // 檢查輸入欄位是否有內容，決定按鈕狀態
    function checkInput() {
      const input = document.getElementById('newMeal');
      const addBtn = document.getElementById('addBtn');
      if (input.value.trim() === '') {
        addBtn.classList.add('disabled-btn');
        addBtn.classList.remove('active-btn');
      } else {
        addBtn.classList.remove('disabled-btn');
        addBtn.classList.add('active-btn');
      }
    }

    // 更新主清單畫面（修改為單一欄位顯示）
    function updateMealList(newMeal = null) {
      const list = document.getElementById('mealList');
      list.innerHTML = '';

      // 建立單一欄位容器
      const column = document.createElement('div');
      column.className = 'meal-column';

      // 依字串長度排序（保留原排序邏輯）
      const sortedMeals = meals.slice().sort((a, b) => a.length - b.length);
      sortedMeals.forEach((meal, sortedIndex) => {
        if (sortedIndex >= 16) return; // 若不需要限制筆數，可移除此行
        const mealItem = document.createElement('div');
        mealItem.className = 'meal-list-item';
        mealItem.setAttribute('data-meal', meal);

        // 判斷該菜餚是否隱藏
        if (hiddenMeals.indexOf(meal) !== -1) {
          mealItem.style.textDecoration = 'line-through';
          mealItem.style.color = '#888';
        } else {
          mealItem.style.textDecoration = 'none';
          mealItem.style.color = '';
        }

        // 點擊菜餚項目，顯示操作選單
        mealItem.onclick = function(e) {
          e.stopPropagation();
          currentMealItem = mealItem;
          currentMealName = meal;
          showActionMenu();
        };

        // 新增菜餚時加入 slide-in 動畫
        if (newMeal && meal === newMeal) {
          mealItem.classList.add('slide-in');
        }

        // 將菜餚名稱加入菜餚項目中
        const mealNameSpan = document.createElement('span');
        mealNameSpan.textContent = meal;
        mealItem.appendChild(mealNameSpan);

        // 將菜餚項目加入單一欄位中
        column.appendChild(mealItem);
      });

      // 將整個欄位加入主清單容器中
      list.appendChild(column);
    }

    // 抽選按鈕功能：只從未隱藏的菜餚中抽取
    function pickRandom() {
      const activeMeals = meals.filter(meal => hiddenMeals.indexOf(meal) === -1);
      if (activeMeals.length === 0) {
        alert('目前沒有可抽取的菜餚！');
        return;
      }
      const randomIndex = Math.floor(Math.random() * activeMeals.length);
      const selectedMeal = activeMeals[randomIndex];
      showMealResult(selectedMeal);
    }

    // 使用 modal 顯示抽選結果
    function showMealResult(selectedMeal) {
      document.getElementById('modalMeal').textContent = selectedMeal;
      document.getElementById('mealModal').style.display = 'flex';
    }

    // 關閉 modal 的函式
    function closeModal() {
      document.getElementById('mealModal').style.display = 'none';
    }

    // 顯示操作選單，根據該菜餚是否隱藏決定按鈕文字與功能
    function showActionMenu() {
      const menu = document.getElementById('actionMenu');
      document.getElementById('actionMenuTitle').textContent = currentMealName;
      const toggleBtn = document.getElementById('toggleHideBtn');
      if (hiddenMeals.indexOf(currentMealName) !== -1) {
        toggleBtn.textContent = '取消隱藏';
        toggleBtn.onclick = unhideMeal;
      } else {
        toggleBtn.textContent = '隱藏';
        toggleBtn.onclick = hideMeal;
      }
      menu.style.display = 'block';
    }

    // 隱藏操作選單
    function hideActionMenu() {
      const menu = document.getElementById('actionMenu');
      menu.style.display = 'none';
      currentMealItem = null;
      currentMealName = null;
    }

    // 按下「隱藏」按鈕：
    // 將該菜餚劃線、變灰，並記錄為隱藏
    function hideMeal() {
      if (currentMealItem && currentMealName) {
        currentMealItem.style.textDecoration = 'line-through';
        currentMealItem.style.color = '#888';
        if (hiddenMeals.indexOf(currentMealName) === -1) {
          hiddenMeals.push(currentMealName);
          saveMeals();
        }
      }
      hideActionMenu();
    }

    // 按下「取消隱藏」按鈕：
    // 將該菜餚恢復預設樣式，從隱藏清單中移除，並重新更新清單
    function unhideMeal() {
      if (currentMealItem && currentMealName) {
        currentMealItem.style.textDecoration = 'none';
        currentMealItem.style.color = '';
        const index = hiddenMeals.indexOf(currentMealName);
        if (index !== -1) {
          hiddenMeals.splice(index, 1);
          saveMeals();
        }
      }
      updateMealList();
      hideActionMenu();
    }

    // 按下「刪除」按鈕：從資料中刪除該菜餚，並更新清單
    function deleteMeal() {
      if (currentMealName) {
        const index = meals.indexOf(currentMealName);
        if (index !== -1) {
          meals.splice(index, 1);
          const hiddenIndex = hiddenMeals.indexOf(currentMealName);
          if (hiddenIndex !== -1) {
            hiddenMeals.splice(hiddenIndex, 1);
          }
          saveMeals();
          updateMealList();
          alert(`已刪除「${currentMealName}」`);
        }
      }
      hideActionMenu();
    }

    // 按下「取消」按鈕：關閉操作選單，不做其他動作
    function cancelAction() {
      hideActionMenu();
    }
  </script>
</body>
</html>
