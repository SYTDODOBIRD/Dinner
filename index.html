<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>晚餐吃什麼?</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      gap: 20px;
    }
    /* 
      預設：桌面版（大螢幕）時顯示兩欄 
      小螢幕時改用媒體查詢處理
    */
    .main-area {
      flex: 2;
    }
    .backup-area {
      flex: 1;
      background-color: #f8f8f8;
      border-radius: 8px;
      padding: 15px;
    }
    h1, h2 {
      text-align: center;
      color: #333;
      margin-bottom: 20px;
    }
    .meal-input {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    input[type="text"] {
      flex: 1;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }
    button {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
      color: white;
    }
    #addBtn {
      background-color: #4CAF50;
    }
    #addBtn:hover {
      background-color: #45a049;
    }
    .disabled-btn {
      background-color: #aaa !important; 
      color: #fff !important; 
    }
    .random-button {
      width: 100%;
      margin-bottom: 20px;
      padding: 12px;
      font-size: 18px;
      background-color: #2196F3;
    }
    .random-button:hover {
      background-color: #1976D2;
    }
    .result {
      text-align: center;
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 20px;
      padding: 20px;
      color: #333;
      min-height: 40px;
      background-color: #f8f8f8;
      border-radius: 8px;
    }
    #resultText {
      transition: opacity 0.5s;
      opacity: 1;
    }
    .meal-management {
      background-color: #f8f8f8;
      padding: 15px;
      border-radius: 8px;
    }
    .meal-list {
      display: flex;
      gap: 10px;
    }
    .meal-column {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .meal-list-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px;
      background-color: white;
      border-radius: 4px;
    }
    @keyframes slideIn {
      from {
        transform: translateX(-100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    @keyframes slideOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }
    @keyframes ashOut {
      0% {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
      50% {
        opacity: 0.5;
        transform: scale(0.9) translateY(-10px) rotate(10deg);
      }
      100% {
        opacity: 0;
        transform: scale(0.7) translateY(-40px) rotate(30deg);
      }
    }
    .slide-in {
      animation: slideIn 0.5s forwards;
    }
    .slide-out {
      animation: slideOut 0.5s forwards;
    }
    .ash-out {
      animation: ashOut 0.8s forwards ease-in;
    }
    .move-btn {
      background-color: #FF9800;
    }
    .move-btn:hover {
      background-color: #FB8C00;
    }
    .delete-btn {
      background-color: #f44336;
    }
    .delete-btn:hover {
      background-color: #da190b;
    }
    .backup-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 10px;
    }
    .backup-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px;
      background-color: white;
      border-radius: 4px;
    }
    .backup-btn-area {
      display: flex;
      gap: 5px;
    }

    /* ================
       手機版處理
       ================ */
    @media (max-width: 768px) {
      .container {
        /* 手機版預設只顯示 main-area，將備用菜餚隱藏 */
        flex-direction: column;
      }
      /* 預設隱藏備用菜餚區域 */
      .backup-area {
        display: none;
      }
      /* 當有 .show-backup 這個類別時，顯示備用菜餚、隱藏 main-area */
      .show-backup .main-area {
        display: none;
      }
      .show-backup .backup-area {
        display: block;
      }
      /* 可以稍微調整字體、內距等 */
      .random-button {
        font-size: 20px;
      }
      .meal-input input[type="text"] {
        font-size: 18px;
      }
      .result {
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="container" id="appContainer">
    <!-- 左側主功能區（主清單） -->
    <div class="main-area" id="mainArea">
      <h1>晚餐吃什麼?</h1>

      <!-- (A) 給手機版用的按鈕：前往備用菜餚 -->
      <button style="margin-bottom: 10px; background: #666;" onclick="showBackup()">備用菜餚</button>

      <div class="meal-input">
        <input type="text" id="newMeal" placeholder="輸入新菜餚">
        <button id="addBtn" onclick="onAddBtnClick()">新增</button>
      </div>

      <button class="random-button" onclick="pickRandom()">抽!</button>

      <!-- 提示訊息區 -->
      <div class="result" id="result">
        <span id="resultText"></span>
      </div>

      <div class="meal-management">
        <h2>菜餚</h2>
        <div class="meal-list" id="mealList">
          <!-- 兩個欄位由 JavaScript 動態產生 -->
        </div>
      </div>
    </div>

    <!-- 右側備用菜餚區 -->
    <div class="backup-area" id="backupArea">
      <h2>備用菜餚</h2>

      <!-- (B) 給手機版用的按鈕：返回主清單 -->
      <button style="margin-bottom: 10px; background: #666;" onclick="showMain()">返回</button>

      <div id="backupList" class="backup-list">
        <!-- 移動過來的菜餚將顯示在此，並可再操作 -->
      </div>
    </div>
  </div>

  <script>
    // 主清單菜餚
    let meals = [
      '牛肉麵',
      '滷味',
      '雞腿便當',
      '滷排便當',
      '韓式泡菜豆腐鍋',
      '三寶飯',
      '炸雞',
      '咖哩飯'
    ];
    // 備用菜餚
    let movedMeals = [];

    window.onload = function() {
      loadMeals();
      updateMealList();
      updateBackupList();
      checkInput();
    }

    // (A) 顯示備用菜餚，隱藏主清單
    function showBackup() {
      // 讓最外層容器加上 .show-backup
      document.getElementById('appContainer').classList.add('show-backup');
    }
    // (B) 顯示主清單，隱藏備用菜餚
    function showMain() {
      document.getElementById('appContainer').classList.remove('show-backup');
    }

    function loadMeals() {
      const storedMeals = localStorage.getItem('meals');
      if (storedMeals) {
        meals = JSON.parse(storedMeals);
      }
      const storedMovedMeals = localStorage.getItem('movedMeals');
      if (storedMovedMeals) {
        movedMeals = JSON.parse(storedMovedMeals);
      }
    }
    function saveMeals() {
      localStorage.setItem('meals', JSON.stringify(meals));
      localStorage.setItem('movedMeals', JSON.stringify(movedMeals));
    }

    function onAddBtnClick() {
      const input = document.getElementById('newMeal');
      const meal = input.value.trim();
      if (!meal) {
        alert('請先填家新菜餚');
        return;
      }
      addMeal(meal);
    }
    function addMeal(meal) {
      if (meals.includes(meal)) {
        displayResult(`菜餚「${meal}」已存在！`, true);
        return;
      }
      if (movedMeals.includes(meal)) {
        displayResult(`菜餚「${meal}」已在備用菜餚！`, true);
        return;
      }
      meals.push(meal);
      saveMeals();
      document.getElementById('newMeal').value = '';
      updateMealList(meal);
      displayResult(`成功新增「${meal}」！`, true);
      checkInput();
    }
    function checkInput() {
      const input = document.getElementById('newMeal');
      const addBtn = document.getElementById('addBtn');
      if (input.value.trim() === '') {
        addBtn.classList.add('disabled-btn');
      } else {
        addBtn.classList.remove('disabled-btn');
      }
    }

    function updateMealList(newMeal = null) {
      const list = document.getElementById('mealList');
      list.innerHTML = '';

      const leftColumn = document.createElement('div');
      leftColumn.className = 'meal-column';
      const rightColumn = document.createElement('div');
      rightColumn.className = 'meal-column';

      const sortedMeals = meals.slice().sort((a, b) => a.length - b.length);

      sortedMeals.forEach((meal, sortedIndex) => {
        if (sortedIndex >= 16) return;
        const mealItem = document.createElement('div');
        mealItem.className = 'meal-list-item';
        mealItem.setAttribute('data-meal', meal);

        if (newMeal && meal === newMeal) {
          mealItem.classList.add('slide-in');
        }
        const mealNameSpan = document.createElement('span');
        mealNameSpan.textContent = meal;
        mealItem.appendChild(mealNameSpan);

        const moveBtn = document.createElement('button');
        moveBtn.className = 'move-btn';
        moveBtn.textContent = '移動';
        moveBtn.onclick = function() {
          moveMeal(this);
        };
        mealItem.appendChild(moveBtn);

        if (sortedIndex % 2 === 0) {
          leftColumn.appendChild(mealItem);
        } else {
          rightColumn.appendChild(mealItem);
        }
      });

      list.appendChild(leftColumn);
      list.appendChild(rightColumn);
    }

    function updateBackupList(newMeal = null) {
      const backupList = document.getElementById('backupList');
      backupList.innerHTML = '';

      movedMeals.forEach(meal => {
        const backupItem = document.createElement('div');
        backupItem.className = 'backup-item';

        if (newMeal && meal === newMeal) {
          backupItem.classList.add('slide-in');
        }

        const mealNameSpan = document.createElement('span');
        mealNameSpan.textContent = meal;
        backupItem.appendChild(mealNameSpan);

        const btnArea = document.createElement('div');
        btnArea.className = 'backup-btn-area';

        const moveBackBtn = document.createElement('button');
        moveBackBtn.className = 'move-btn';
        moveBackBtn.textContent = '移動';
        moveBackBtn.onclick = function() {
          moveMealBack(meal, backupItem);
        };
        btnArea.appendChild(moveBackBtn);

        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-btn';
        deleteBtn.textContent = '刪除';
        deleteBtn.onclick = function() {
          const confirmDelete = confirm(`確定要刪除「${meal}」嗎？`);
          if (confirmDelete) {
            deleteFromBackup(meal, backupItem);
          }
        };
        btnArea.appendChild(deleteBtn);

        backupItem.appendChild(btnArea);
        backupList.appendChild(backupItem);
      });
    }

    function moveMeal(btnElement) {
      const mealItem = btnElement.parentElement;
      const mealName = mealItem.getAttribute('data-meal');
      mealItem.classList.remove('slide-in');
      void mealItem.offsetWidth;
      mealItem.classList.add('slide-out');
      mealItem.addEventListener('animationend', function() {
        const index = meals.indexOf(mealName);
        if (index !== -1) {
          meals.splice(index, 1);
        }
        movedMeals.push(mealName);
        saveMeals();
        updateMealList();
        updateBackupList(mealName);
        displayResult(`已將「${mealName}」移至備用菜餚`, true);
      }, { once: true });
    }

    function moveMealBack(mealName, backupItem) {
      backupItem.classList.remove('slide-in');
      void backupItem.offsetWidth;
      backupItem.classList.add('slide-out');
      backupItem.addEventListener('animationend', function() {
        const index = movedMeals.indexOf(mealName);
        if (index !== -1) {
          movedMeals.splice(index, 1);
        }
        meals.push(mealName);
        saveMeals();
        updateMealList(mealName);
        updateBackupList();
        displayResult(`已將「${mealName}」移回主清單`, true);
      }, { once: true });
    }

    function deleteFromBackup(mealName, backupItem) {
      backupItem.classList.remove('slide-in');
      void backupItem.offsetWidth;
      backupItem.classList.add('ash-out');
      backupItem.addEventListener('animationend', function() {
        const index = movedMeals.indexOf(mealName);
        if (index !== -1) {
          movedMeals.splice(index, 1);
          saveMeals();
          updateBackupList();
          displayResult(`已刪除「${mealName}」`, true);
        }
      }, { once: true });
    }

    function pickRandom() {
      if (meals.length === 0) {
        displayResult('請先新增一些菜餚！', false);
        return;
      }
      const randomIndex = Math.floor(Math.random() * meals.length);
      displayResult(meals[randomIndex], false);
    }

    function displayResult(message, fade) {
      const resultText = document.getElementById('resultText');
      resultText.textContent = message;
      resultText.style.opacity = 1;
      if (fade) {
        setTimeout(() => {
          resultText.style.opacity = 0;
        }, 2000);
      }
    }

    document.getElementById('newMeal').addEventListener('input', checkInput);
    document.getElementById('newMeal').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        onAddBtnClick();
      }
    });
  </script>
</body>
</html>
