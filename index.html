<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>吃什麼?</title>
  <style>
    /* 版本資訊 */
    .version {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 14px;
      color: #555;
      opacity: 0.8;
    }
    /* 基本樣式 */
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
      text-align: center;
    }
    .container {
      position: relative;
      max-width: 1000px;
      margin: 0 auto;
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1, h2 {
      color: #333;
      margin-bottom: 20px;
    }
    .meal-input {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      justify-content: center;
    }
    input[type="text"] {
      flex: 1;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }
    button {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
      color: white;
    }
    #addBtn {
      background-color: #4CAF50;
    }
    #addBtn:hover {
      background-color: #45a049;
    }
    .disabled-btn {
      background-color: #aaa !important;
      color: #fff !important;
    }
    .active-btn {
      background-color: #4CAF50 !important;
      color: #fff !important;
    }
    .random-button {
      width: 100%;
      margin-bottom: 20px;
      padding: 12px;
      font-size: 18px;
      background-color: #2196F3;
    }
    .random-button:hover {
      background-color: #1976D2;
    }
    .meal-management {
      background-color: #f8f8f8;
      padding: 15px;
      border-radius: 8px;
    }
    /* 根據視窗高度自動調整菜餚清單高度 */
    .meal-list {
      max-height: calc(100vh - 300px); /* 此數值可根據其它內容高度調整 */
      overflow-y: auto;
      display: flex;
      justify-content: center;
    }
    .meal-column {
      display: flex;
      flex-direction: column;
      gap: 8px;
      width: 100%;
    }
    /* 固定菜餚項目高度，並移除點擊後藍色框 */
    .meal-list-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px;
      background-color: white;
      border-radius: 4px;
      cursor: pointer;
      position: relative;
      height: 40px;
      outline: none;
      -webkit-tap-highlight-color: transparent;
    }
    /* 動畫效果 */
    @keyframes slideIn {
      from { transform: translateX(-100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideOut {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(100%); opacity: 0; }
    }
    .slide-in { animation: slideIn 0.5s forwards; }
    .slide-out { animation: slideOut 0.5s forwards; }
    .delete-btn {
      background-color: #f44336;
    }
    .delete-btn:hover {
      background-color: #da190b;
    }
    /* Modal 視窗樣式 */
    .modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      width: 80%;
      max-width: 400px;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    .close-btn {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 18px;
      cursor: pointer;
      color: #aaa;
    }
    .close-btn:hover {
      color: #000;
    }
    .modal h1 {
      font-size: 24px;
      color: #333;
      margin: 0;
    }
    .modal .meal {
      font-size: 30px;
      font-weight: bold;
      color: #d32f2f;
      margin: 0;
      text-align: center;
    }
    /* 操作選單樣式 */
    .action-menu {
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      background-color: #fff;
      border: 1px solid #ccc;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      display: none;
      z-index: 3000;
      min-width: 300px;
    }
    .action-menu h3 {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 20px;
      color: #333;
    }
    .action-menu .btn-container {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }
    .action-menu .btn-container button {
      flex: 1;
      padding: 8px;
      font-size: 16px;
      border-radius: 4px;
    }
    .action-menu .hide-btn {
      background-color: #4CAF50;
    }
    .action-menu .cancel-btn {
      background-color: #9E9E9E;
    }
    .action-menu .delete-btn {
      background-color: #f44336;
    }
    /* overlay 全頁遮罩：灰色半透明，點擊可取消操作選單 */
    #overlay {
      display: none;
      position: fixed;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      z-index: 2500;
      background: rgba(0, 0, 0, 0.5);
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container" id="appContainer">
    <div class="version">Version 1.0</div>
    <div class="main-area" id="mainArea">
      <h1>吃什麼?</h1>
      <div class="meal-input">
        <input type="text" id="newMeal" placeholder="輸入新菜餚" oninput="checkInput()">
        <button id="addBtn" onclick="onAddBtnClick()">新增</button>
      </div>
      <button class="random-button" onclick="pickRandom()">抽!</button>
      <div class="meal-management">
        <h2>菜餚</h2>
        <div class="meal-list" id="mealList">
          <!-- 菜餚清單由 JavaScript 動態產生 -->
        </div>
      </div>
    </div>
  </div>

  <!-- Modal 視窗 -->
  <div id="mealModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal()">&times;</span>
      <div class="meal" id="modalMeal"></div>
    </div>
  </div>

  <!-- 操作選單 -->
  <div id="actionMenu" class="action-menu">
    <h3 id="actionMenuTitle"></h3>
    <div class="btn-container">
      <button id="toggleHideBtn" class="hide-btn" onclick="">隱藏</button>
      <button class="cancel-btn" onclick="cancelAction()">取消</button>
      <button class="delete-btn" onclick="deleteMeal()">刪除</button>
    </div>
  </div>
  
  <!-- overlay 全頁遮罩 -->
  <div id="overlay" onclick="cancelAction()"></div>

  <script>
    // 主清單預設菜餚
    let meals = [
      '炒飯',
      '牛肉麵',
      '炸雞',
      '咖哩飯',
      '滷味便當',
      '酸菜白肉面',
      '三寶飯'
    ];
    let hiddenMeals = [];
    let currentMealItem = null;
    let currentMealName = null;

    window.onload = function() {
      loadMeals();
      updateMealList();
      checkInput();
    };

    function loadMeals() {
      const storedMeals = localStorage.getItem('meals');
      if (storedMeals) meals = JSON.parse(storedMeals);
      const storedHidden = localStorage.getItem('hiddenMeals');
      if (storedHidden) hiddenMeals = JSON.parse(storedHidden);
    }

    function saveMeals() {
      localStorage.setItem('meals', JSON.stringify(meals));
      localStorage.setItem('hiddenMeals', JSON.stringify(hiddenMeals));
    }

    function onAddBtnClick() {
      const input = document.getElementById('newMeal');
      const meal = input.value.trim();
      if (!meal) {
        alert('請先填入新菜餚');
        return;
      }
      if (meals.includes(meal)) {
        alert(`菜餚「${meal}」已存在！`);
        return;
      }
      meals.push(meal);
      saveMeals();
      input.value = '';
      updateMealList(meal);
      alert(`成功新增「${meal}」！`);
      checkInput();
    }

    function checkInput() {
      const input = document.getElementById('newMeal');
      const addBtn = document.getElementById('addBtn');
      if (input.value.trim() === '') {
        addBtn.classList.add('disabled-btn');
        addBtn.classList.remove('active-btn');
      } else {
        addBtn.classList.remove('disabled-btn');
        addBtn.classList.add('active-btn');
      }
    }

    function updateMealList(newMeal = null) {
      const list = document.getElementById('mealList');
      list.innerHTML = '';
      const column = document.createElement('div');
      column.className = 'meal-column';
      const sortedMeals = meals.slice().sort((a, b) => a.length - b.length);
      sortedMeals.forEach((meal, sortedIndex) => {
        if (sortedIndex >= 16) return;
        const mealItem = document.createElement('div');
        mealItem.className = 'meal-list-item';
        mealItem.setAttribute('data-meal', meal);
        if (hiddenMeals.indexOf(meal) !== -1) {
          mealItem.style.textDecoration = 'line-through';
          mealItem.style.color = '#888';
        } else {
          mealItem.style.textDecoration = 'none';
          mealItem.style.color = '';
        }
        mealItem.onclick = function(e) {
          e.stopPropagation();
          currentMealItem = mealItem;
          currentMealName = meal;
          showActionMenu();
        };
        if (newMeal && meal === newMeal) mealItem.classList.add('slide-in');
        const mealNameSpan = document.createElement('span');
        mealNameSpan.textContent = meal;
        mealItem.appendChild(mealNameSpan);
        column.appendChild(mealItem);
      });
      list.appendChild(column);
    }

    function pickRandom() {
      const activeMeals = meals.filter(meal => hiddenMeals.indexOf(meal) === -1);
      if (activeMeals.length === 0) {
        alert('目前沒有可抽取的菜餚！');
        return;
      }
      const randomIndex = Math.floor(Math.random() * activeMeals.length);
      const selectedMeal = activeMeals[randomIndex];
      showMealResult(selectedMeal);
    }

    function showMealResult(selectedMeal) {
      document.getElementById('modalMeal').textContent = selectedMeal;
      document.getElementById('mealModal').style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('mealModal').style.display = 'none';
    }

    function showActionMenu() {
      document.getElementById('overlay').style.display = 'block';
      const menu = document.getElementById('actionMenu');
      document.getElementById('actionMenuTitle').textContent = currentMealName;
      const toggleBtn = document.getElementById('toggleHideBtn');
      if (hiddenMeals.indexOf(currentMealName) !== -1) {
        toggleBtn.textContent = '取消隱藏';
        toggleBtn.onclick = unhideMeal;
      } else {
        toggleBtn.textContent = '隱藏';
        toggleBtn.onclick = hideMeal;
      }
      menu.style.display = 'block';
    }

    function hideActionMenu() {
      document.getElementById('overlay').style.display = 'none';
      const menu = document.getElementById('actionMenu');
      menu.style.display = 'none';
      currentMealItem = null;
      currentMealName = null;
    }

    function hideMeal() {
      if (currentMealItem && currentMealName) {
        currentMealItem.style.textDecoration = 'line-through';
        currentMealItem.style.color = '#888';
        if (hiddenMeals.indexOf(currentMealName) === -1) {
          hiddenMeals.push(currentMealName);
          saveMeals();
        }
      }
      hideActionMenu();
    }

    function unhideMeal() {
      if (currentMealItem && currentMealName) {
        currentMealItem.style.textDecoration = 'none';
        currentMealItem.style.color = '';
        const index = hiddenMeals.indexOf(currentMealName);
        if (index !== -1) {
          hiddenMeals.splice(index, 1);
          saveMeals();
        }
      }
      updateMealList();
      hideActionMenu();
    }

    function deleteMeal() {
      if (currentMealName) {
        const index = meals.indexOf(currentMealName);
        if (index !== -1) {
          meals.splice(index, 1);
          const hiddenIndex = hiddenMeals.indexOf(currentMealName);
          if (hiddenIndex !== -1) {
            hiddenMeals.splice(hiddenIndex, 1);
          }
          saveMeals();
          updateMealList();
          alert(`已刪除「${currentMealName}」`);
        }
      }
      hideActionMenu();
    }

    function cancelAction() {
      hideActionMenu();
    }
  </script>
</body>
</html>
