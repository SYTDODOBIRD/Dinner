<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>晚餐吃什麼?</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      gap: 20px;
    }
    /* 左側主區域 */
    .main-area {
      flex: 2;
    }
    /* 右側備用菜餚 */
    .backup-area {
      flex: 1;
      background-color: #f8f8f8;
      border-radius: 8px;
      padding: 15px;
    }
    h1, h2 {
      text-align: center;
      color: #333;
      margin-bottom: 20px;
    }
    .meal-input {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    input[type="text"] {
      flex: 1;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }

    /* ------------------------
       按鈕樣式
       ------------------------ */
    button {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
      color: white; /* 預設文字為白色 */
    }
    /* 新增按鈕：正常狀態(綠色) */
    #addBtn {
      background-color: #4CAF50;
    }
    #addBtn:hover {
      background-color: #45a049;
    }
    /* (1) 不可用時改用自訂類別 .disabled-btn，背景灰色，字體保持白色 */
    .disabled-btn {
      background-color: #aaa !important; 
      color: #fff !important; 
    }
    /* 「抽!」按鈕 */
    .random-button {
      width: 100%;
      margin-bottom: 20px;
      padding: 12px;
      font-size: 18px;
      background-color: #2196F3;
    }
    .random-button:hover {
      background-color: #1976D2;
    }

    /* ------------------------
       結果與區塊樣式
       ------------------------ */
    .result {
      text-align: center;
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 20px;
      padding: 20px;
      color: #333;
      min-height: 40px;
      background-color: #f8f8f8;
      border-radius: 8px;
    }
    #resultText {
      transition: opacity 0.5s;
      opacity: 1;
    }
    .meal-management {
      background-color: #f8f8f8;
      padding: 15px;
      border-radius: 8px;
    }
    .meal-list {
      display: flex;
      gap: 10px;
    }
    .meal-column {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .meal-list-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px;
      background-color: white;
      border-radius: 4px;
    }

    /* ------------------------
       動畫 Keyframes
       ------------------------ */
    @keyframes slideIn {
      from {
        transform: translateX(-100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    @keyframes slideOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }
    @keyframes ashOut {
      0% {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
      50% {
        opacity: 0.5;
        transform: scale(0.9) translateY(-10px) rotate(10deg);
      }
      100% {
        opacity: 0;
        transform: scale(0.7) translateY(-40px) rotate(30deg);
      }
    }

    .slide-in {
      animation: slideIn 0.5s forwards;
    }
    .slide-out {
      animation: slideOut 0.5s forwards;
    }
    /* 灰飛煙滅動畫 */
    .ash-out {
      animation: ashOut 0.8s forwards ease-in;
    }

    /* 移動按鈕改為橘色 */
    .move-btn {
      background-color: #FF9800; /* 橘色 */
    }
    .move-btn:hover {
      background-color: #FB8C00;
    }

    /* 刪除按鈕為紅色 */
    .delete-btn {
      background-color: #f44336;
    }
    .delete-btn:hover {
      background-color: #da190b;
    }

    /* ------------------------
       備用菜餚列表
       ------------------------ */
    .backup-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 10px;
    }
    .backup-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px;
      background-color: white;
      border-radius: 4px;
    }
    .backup-btn-area {
      display: flex;
      gap: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- 左側主功能區 -->
    <div class="main-area">
      <h1>晚餐吃什麼?</h1>

      <div class="meal-input">
        <!-- (2) 移除 disabled，改用自訂機制控制 -->
        <input type="text" id="newMeal" placeholder="輸入新菜餚">
        <button id="addBtn" onclick="onAddBtnClick()">新增</button>
      </div>

      <button class="random-button" onclick="pickRandom()">抽!</button>

      <!-- 提示訊息區 -->
      <div class="result" id="result">
        <span id="resultText"></span>
      </div>

      <div class="meal-management">
        <h2>菜餚</h2>
        <div class="meal-list" id="mealList">
          <!-- 兩個欄位由 JavaScript 動態產生 -->
        </div>
      </div>
    </div>

    <div class="backup-area">
      <h2>備用菜餚</h2>
      <div id="backupList" class="backup-list">
        <!-- 移動過來的菜餚將顯示在此，並可再操作 -->
      </div>
    </div>
  </div>

  <script>
    // 預設菜餚（主清單）
    let meals = [
      '牛肉麵',
      '滷味',
      '雞腿便當',
      '滷排便當',
      '韓式泡菜豆腐鍋',
      '三寶飯',
      '炸雞',
      '咖哩飯'
    ];

    // 備用菜餚
    let movedMeals = [];

    // 頁面載入時執行
    window.onload = function() {
      loadMeals();
      updateMealList();
      updateBackupList();
      checkInput(); // 檢查輸入框，控制按鈕狀態
    }

    /**
     * 讀取 localStorage
     */
    function loadMeals() {
      const storedMeals = localStorage.getItem('meals');
      if (storedMeals) {
        meals = JSON.parse(storedMeals);
      }
      const storedMovedMeals = localStorage.getItem('movedMeals');
      if (storedMovedMeals) {
        movedMeals = JSON.parse(storedMovedMeals);
      }
    }

    /**
     * 儲存至 localStorage
     */
    function saveMeals() {
      localStorage.setItem('meals', JSON.stringify(meals));
      localStorage.setItem('movedMeals', JSON.stringify(movedMeals));
    }

    /**
     * 當按下「新增」按鈕時
     * 若輸入框是空白，顯示提示；否則呼叫 addMeal()
     */
    function onAddBtnClick() {
      const input = document.getElementById('newMeal');
      const meal = input.value.trim();
      if (!meal) {
        // (2) 如果是空白，顯示提示
        alert('請先填家新菜餚');
        return;
      }
      // 如果不空白，正常新增
      addMeal(meal);
    }

    /**
     * 真正執行新增菜餚到主清單
     */
    function addMeal(meal) {
      // 檢查是否已存在於主清單
      if (meals.includes(meal)) {
        displayResult(`菜餚「${meal}」已存在！`, true);
        return;
      }
      // 檢查是否已存在於備用菜餚
      if (movedMeals.includes(meal)) {
        displayResult(`菜餚「${meal}」已在備用菜餚！`, true);
        return;
      }

      meals.push(meal);
      saveMeals();

      // 清空輸入框並更新清單
      const input = document.getElementById('newMeal');
      input.value = '';
      updateMealList(meal); // 讓新菜餚有滑入動畫
      displayResult(`成功新增「${meal}」！`, true);

      // 再次檢查輸入框，更新按鈕狀態
      checkInput();
    }

    /**
     * 檢查輸入框是否有值，控制「新增」按鈕的外觀
     */
    function checkInput() {
      const input = document.getElementById('newMeal');
      const addBtn = document.getElementById('addBtn');
      // 如果輸入框為空，就加上灰色類別；否則移除
      if (input.value.trim() === '') {
        addBtn.classList.add('disabled-btn');
      } else {
        addBtn.classList.remove('disabled-btn');
      }
    }

    /**
     * 更新主菜餚清單
     * @param {string|null} newMeal - 新加入的菜餚名稱（若為 null 則不執行滑入動畫）。
     */
    function updateMealList(newMeal = null) {
      const list = document.getElementById('mealList');
      list.innerHTML = '';

      const leftColumn = document.createElement('div');
      leftColumn.className = 'meal-column';
      const rightColumn = document.createElement('div');
      rightColumn.className = 'meal-column';

      // 依照字數由少到多排序
      const sortedMeals = meals.slice().sort((a, b) => a.length - b.length);

      sortedMeals.forEach((meal, sortedIndex) => {
        if (sortedIndex >= 16) return;
        const mealItem = document.createElement('div');
        mealItem.className = 'meal-list-item';
        mealItem.setAttribute('data-meal', meal);

        // 若為最新加入的菜餚，套用滑入動畫
        if (newMeal && meal === newMeal) {
          mealItem.classList.add('slide-in');
        }

        // 菜餚名稱
        const mealNameSpan = document.createElement('span');
        mealNameSpan.textContent = meal;
        mealItem.appendChild(mealNameSpan);

        // 「移動」按鈕（橘色）
        const moveBtn = document.createElement('button');
        moveBtn.className = 'move-btn';
        moveBtn.textContent = '移動';
        moveBtn.onclick = function() {
          moveMeal(this);
        };
        mealItem.appendChild(moveBtn);

        // 交錯放入左右欄
        if (sortedIndex % 2 === 0) {
          leftColumn.appendChild(mealItem);
        } else {
          rightColumn.appendChild(mealItem);
        }
      });

      list.appendChild(leftColumn);
      list.appendChild(rightColumn);
    }

    /**
     * 更新備用菜餚清單
     * @param {string|null} newMeal - 剛移到備用菜餚的名稱（若為 null 則不執行滑入動畫）。
     */
    function updateBackupList(newMeal = null) {
      const backupList = document.getElementById('backupList');
      backupList.innerHTML = '';

      movedMeals.forEach(meal => {
        const backupItem = document.createElement('div');
        backupItem.className = 'backup-item';

        // 若是剛移入的菜餚，套用滑入動畫
        if (newMeal && meal === newMeal) {
          backupItem.classList.add('slide-in');
        }

        // 菜餚名稱
        const mealNameSpan = document.createElement('span');
        mealNameSpan.textContent = meal;
        backupItem.appendChild(mealNameSpan);

        // 按鈕區域
        const btnArea = document.createElement('div');
        btnArea.className = 'backup-btn-area';

        // 「移動」(橘色) - 移回主清單
        const moveBackBtn = document.createElement('button');
        moveBackBtn.className = 'move-btn';
        moveBackBtn.textContent = '移動';
        moveBackBtn.onclick = function() {
          moveMealBack(meal, backupItem);
        };
        btnArea.appendChild(moveBackBtn);

        // 「刪除」(紅色) - 灰飛煙滅
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-btn';
        deleteBtn.textContent = '刪除';
        deleteBtn.onclick = function() {
          const confirmDelete = confirm(`確定要刪除「${meal}」嗎？`);
          if (confirmDelete) {
            deleteFromBackup(meal, backupItem);
          }
        };
        btnArea.appendChild(deleteBtn);

        backupItem.appendChild(btnArea);
        backupList.appendChild(backupItem);
      });
    }

    /**
     * 從主清單移動到備用菜餚 (滑出動畫)
     */
    function moveMeal(btnElement) {
      const mealItem = btnElement.parentElement;
      const mealName = mealItem.getAttribute('data-meal');

      // 先移除滑入動畫
      mealItem.classList.remove('slide-in');
      // 強制 reflow
      void mealItem.offsetWidth;
      // 加上滑出動畫
      mealItem.classList.add('slide-out');

      mealItem.addEventListener('animationend', function() {
        // 從主清單移除
        const index = meals.indexOf(mealName);
        if (index !== -1) {
          meals.splice(index, 1);
        }
        // 加入備用菜餚
        movedMeals.push(mealName);
        saveMeals();

        updateMealList();
        updateBackupList(mealName); // 對剛移過去的菜餚套用滑入
        displayResult(`已將「${mealName}」移至備用菜餚`, true);
      }, { once: true });
    }

    /**
     * 從備用菜餚移回主清單 (滑出動畫)
     */
    function moveMealBack(mealName, backupItem) {
      // 先移除滑入動畫
      backupItem.classList.remove('slide-in');
      // 強制 reflow
      void backupItem.offsetWidth;
      // 加上滑出動畫
      backupItem.classList.add('slide-out');

      backupItem.addEventListener('animationend', function() {
        // 從 movedMeals 移除
        const index = movedMeals.indexOf(mealName);
        if (index !== -1) {
          movedMeals.splice(index, 1);
        }
        // 加回主清單
        meals.push(mealName);
        saveMeals();

        updateMealList(mealName); // 對剛移回的菜餚套用滑入
        updateBackupList();
        displayResult(`已將「${mealName}」移回主清單`, true);
      }, { once: true });
    }

    /**
     * 從備用菜餚刪除 (灰飛煙滅)
     */
    function deleteFromBackup(mealName, backupItem) {
      // 先移除滑入動畫
      backupItem.classList.remove('slide-in');
      // 強制 reflow
      void backupItem.offsetWidth;
      // 加上灰飛煙滅動畫
      backupItem.classList.add('ash-out');

      backupItem.addEventListener('animationend', function() {
        const index = movedMeals.indexOf(mealName);
        if (index !== -1) {
          movedMeals.splice(index, 1);
          saveMeals();
          updateBackupList();
          displayResult(`已刪除「${mealName}」`, true);
        }
      }, { once: true });
    }

    /**
     * 抽取菜餚
     */
    function pickRandom() {
      if (meals.length === 0) {
        displayResult('請先新增一些菜餚！', false);
        return;
      }
      const randomIndex = Math.floor(Math.random() * meals.length);
      displayResult(meals[randomIndex], false);
    }

    /**
     * 顯示提示訊息
     * @param {string} message 訊息
     * @param {boolean} fade 是否在一段時間後淡出
     */
    function displayResult(message, fade) {
      const resultText = document.getElementById('resultText');
      resultText.textContent = message;
      resultText.style.opacity = 1;

      // 淡出時間 2 秒
      if (fade) {
        setTimeout(() => {
          resultText.style.opacity = 0;
        }, 2000);
      }
    }

    // 當輸入框內容改變時，動態更新按鈕外觀
    document.getElementById('newMeal').addEventListener('input', checkInput);

    // 若使用者按下 Enter 鍵，也嘗試新增
    document.getElementById('newMeal').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        onAddBtnClick();
      }
    });
  </script>
</body>
</html>
