<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>晚餐吃什麼?</title>
  <style>
    /* 基本樣式 */
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
      text-align: center;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      gap: 20px;
    }
    /* 主區與備用區樣式 */
    .main-area {
      flex: 2;
    }
    .backup-area {
      flex: 1;
      background-color: #f8f8f8;
      border-radius: 8px;
      padding: 15px;
      display: block;
    }
    h1, h2 {
      color: #333;
      margin-bottom: 20px;
    }
    .meal-input {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      justify-content: center;
    }
    input[type="text"] {
      flex: 1;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }
    button {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
      color: white;
    }
    #addBtn {
      background-color: #4CAF50;
    }
    #addBtn:hover {
      background-color: #45a049;
    }
    .disabled-btn {
      background-color: #aaa !important; 
      color: #fff !important; 
    }
    .random-button {
      width: 100%;
      margin-bottom: 20px;
      padding: 12px;
      font-size: 18px;
      background-color: #2196F3;
    }
    .random-button:hover {
      background-color: #1976D2;
    }
    .meal-management {
      background-color: #f8f8f8;
      padding: 15px;
      border-radius: 8px;
    }
    .meal-list {
      display: flex;
      gap: 10px;
      justify-content: center;
    }
    .meal-column {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .meal-list-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px;
      background-color: white;
      border-radius: 4px;
      /* 行動版時要可點擊整塊，給個 cursor pointer */
      cursor: pointer;
    }
    @keyframes slideIn {
      from {
        transform: translateX(-100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    @keyframes slideOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }
    @keyframes ashOut {
      0% {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
      50% {
        opacity: 0.5;
        transform: scale(0.9) translateY(-10px) rotate(10deg);
      }
      100% {
        opacity: 0;
        transform: scale(0.7) translateY(-40px) rotate(30deg);
      }
    }
    .slide-in {
      animation: slideIn 0.5s forwards;
    }
    .slide-out {
      animation: slideOut 0.5s forwards;
    }
    .ash-out {
      animation: ashOut 0.8s forwards ease-in;
    }
    .move-btn {
      background-color: #FF9800;
    }
    .move-btn:hover {
      background-color: #FB8C00;
    }
    .delete-btn {
      background-color: #f44336;
    }
    .delete-btn:hover {
      background-color: #da190b;
    }
    .backup-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 10px;
    }
    .backup-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px;
      background-color: white;
      border-radius: 4px;
      cursor: pointer; /* 行動版也可點整塊 */
    }
    .backup-btn-area {
      display: flex;
      gap: 5px;
    }
    /* 側邊備用按鈕（行動裝置） */
    #sideBackupBtn {
      position: fixed;
      top: 50%;
      left: 0;
      transform: translate(-50%, -50%) rotate(-90deg);
      transform-origin: center;
      background-color: #666;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      z-index: 1000;
      transition: background-color 0.3s;
    }
    #sideBackupBtn:hover {
      background-color: #555;
    }
    /* 行動裝置樣式（螢幕寬度 ≤ 768px） */
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }
      .backup-area {
        display: none;
      }
      .show-backup .main-area {
        display: none;
      }
      .show-backup .backup-area {
        display: block;
      }
      #sideBackupBtn {
        display: block;
      }
      .mobile-only {
        display: block;
      }
      /* 
        行動版時，隱藏主清單中的「移動」按鈕 
        (也可視需求一併隱藏刪除按鈕，如果本來有的話)
      */
      .meal-list-item .move-btn {
        display: none;
      }
      .meal-list-item .delete-btn {
        display: none;
      }
    }
    /* 桌面版（螢幕寬度 ≥ 769px） */
    @media (min-width: 769px) {
      #sideBackupBtn {
        display: none;
      }
      .backup-area {
        display: block;
      }
      .mobile-only {
        display: none;
      }
    }
    /* Modal 視窗樣式 */
    .modal {
      display: none; /* 預設隱藏 */
      position: fixed;
      z-index: 2000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      width: 80%;
      max-width: 400px;
      position: relative;
      margin-top: 10%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    .close-btn {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 18px;
      cursor: pointer;
      color: #aaa;
    }
    .close-btn:hover {
      color: #000;
    }
    .modal h1 {
      font-size: 24px;
      color: #333;
      margin: 0;
    }
    .modal .meal {
      font-size: 30px;
      font-weight: bold;
      color: #d32f2f;
      margin: 0;
    }

    /* 行動版彈出選單 (示範用) */
    .mobile-menu {
      display: none; /* 預設隱藏 */
      position: fixed;
      z-index: 3000; /* 高於 modal */
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      background-color: #ffffff;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    .mobile-menu h3 {
      margin-top: 0;
      margin-bottom: 10px;
      color: #333;
    }
    .mobile-menu button {
      margin: 5px;
      padding: 8px 16px;
      font-size: 16px;
      border-radius: 4px;
      border: none;
      color: #fff;
    }
    .mobile-menu .move-btn {
      background-color: #FF9800;
    }
    .mobile-menu .delete-btn {
      background-color: #f44336;
    }
    /* 新增的「取消」按鈕，可以給個中性顏色 */
    .mobile-menu .cancel-btn {
      background-color: #666;
    }
  </style>
</head>
<body>
  <!-- 側邊備用按鈕（僅行動裝置） -->
  <button id="sideBackupBtn" onclick="showBackup()">備用菜餚</button>
  
  <div class="container" id="appContainer">
    <!-- 主功能區（主清單） -->
    <div class="main-area" id="mainArea">
      <h1>晚餐吃什麼?</h1>
      
      <div class="meal-input">
        <input type="text" id="newMeal" placeholder="輸入新菜餚">
        <button id="addBtn" onclick="onAddBtnClick()">新增</button>
      </div>

      <button class="random-button" onclick="pickRandom()">抽!</button>

      <div class="meal-management">
        <h2>菜餚</h2>
        <div class="meal-list" id="mealList">
          <!-- 由 JavaScript 動態產生兩欄 -->
        </div>
      </div>
    </div>

    <!-- 備用菜餚區 -->
    <div class="backup-area" id="backupArea">
      <h2>備用菜餚</h2>
      <!-- 返回主清單按鈕（僅行動裝置） -->
      <button class="mobile-only" style="margin-bottom: 10px; background: #666;" onclick="showMain()"><</button>
      <div id="backupList" class="backup-list">
        <!-- 移動過來的菜餚會顯示在此 -->
      </div>
    </div>
  </div>

  <!-- Modal 視窗結構（抽選結果） -->
  <div id="mealModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal()">&times;</span>
      <h1>今晚吃：</h1>
      <div class="meal" id="modalMeal"></div>
    </div>
  </div>

  <!-- 行動版專用的彈出選單 -->
  <div id="mobileMenu" class="mobile-menu">
    <h3 id="mobileMenuTitle"></h3>
    <button class="move-btn" onclick="onMobileMove()">移動</button>
    <button class="delete-btn" onclick="onMobileDelete()">刪除</button>
    <!-- 新增的「取消」按鈕 -->
    <button class="cancel-btn" onclick="closeMobileMenu()">取消</button>
  </div>

  <script>
    // 主清單預設資料
    let meals = [
      '炒飯',
      '牛肉麵',
      '炸雞',
      '咖哩飯',
      '滷味便當',
      '酸菜白肉面',
      '三寶飯'
    ];
    // 備用菜餚資料
    let movedMeals = [];

    // 用來暫存行動版目前被點擊的「菜餚名稱」及其DOM元素
    let currentClickedMealName = null;
    let currentClickedMealItem = null;

    window.onload = function() {
      loadMeals();
      updateMealList();
      updateBackupList();
      checkInput();
    };

    // 行動裝置：顯示備用菜餚區
    function showBackup() {
      document.getElementById('appContainer').classList.add('show-backup');
    }
    // 行動裝置：返回主清單
    function showMain() {
      document.getElementById('appContainer').classList.remove('show-backup');
    }

    // 載入 localStorage 資料
    function loadMeals() {
      const storedMeals = localStorage.getItem('meals');
      if (storedMeals) {
        meals = JSON.parse(storedMeals);
      }
      const storedMovedMeals = localStorage.getItem('movedMeals');
      if (storedMovedMeals) {
        movedMeals = JSON.parse(storedMovedMeals);
      }
    }
    // 儲存資料至 localStorage
    function saveMeals() {
      localStorage.setItem('meals', JSON.stringify(meals));
      localStorage.setItem('movedMeals', JSON.stringify(movedMeals));
    }

    // 新增按鈕點擊：新增菜餚並立即抽選
    function onAddBtnClick() {
      const input = document.getElementById('newMeal');
      const meal = input.value.trim();
      
      if (!meal) {
        alert('請先填入新菜餚');
        return;
      }
      if (meals.includes(meal)) {
        alert(`菜餚「${meal}」已存在！`);
        return;
      }
      if (movedMeals.includes(meal)) {
        alert(`菜餚「${meal}」已在備用菜餚！`);
        return;
      }
      
      meals.push(meal);
      saveMeals();
      input.value = '';
      updateMealList(meal);
      alert(`成功新增「${meal}」！`);
      checkInput();
      
      if (meals.length === 0) {
        alert('請先新增一些菜餚！');
        return;
      }
      const randomIndex = Math.floor(Math.random() * meals.length);
      const selectedMeal = meals[randomIndex];
      showMealResult(selectedMeal);
    }

    // 檢查輸入欄位是否有內容，決定按鈕狀態
    function checkInput() {
      const input = document.getElementById('newMeal');
      const addBtn = document.getElementById('addBtn');
      if (input.value.trim() === '') {
        addBtn.classList.add('disabled-btn');
      } else {
        addBtn.classList.remove('disabled-btn');
      }
    }

    // 更新主清單畫面
    function updateMealList(newMeal = null) {
      const list = document.getElementById('mealList');
      list.innerHTML = '';

      const leftColumn = document.createElement('div');
      leftColumn.className = 'meal-column';
      const rightColumn = document.createElement('div');
      rightColumn.className = 'meal-column';

      // 依字串長度排序後分配左右欄位，限制顯示筆數
      const sortedMeals = meals.slice().sort((a, b) => a.length - b.length);
      sortedMeals.forEach((meal, sortedIndex) => {
        if (sortedIndex >= 16) return;
        const mealItem = document.createElement('div');
        mealItem.className = 'meal-list-item';
        mealItem.setAttribute('data-meal', meal);

        // 行動版：點擊整塊 => 顯示選單
        mealItem.onclick = function() {
          onMealItemClick(meal, mealItem);
        };

        if (newMeal && meal === newMeal) {
          mealItem.classList.add('slide-in');
        }
        const mealNameSpan = document.createElement('span');
        mealNameSpan.textContent = meal;
        mealItem.appendChild(mealNameSpan);

        // 桌面版繼續顯示「移動」按鈕 (行動版用CSS隱藏)
        const moveBtn = document.createElement('button');
        moveBtn.className = 'move-btn';
        moveBtn.textContent = '移動';
        moveBtn.onclick = function(e) {
          // 避免點擊按鈕時也觸發 mealItem.onclick
          e.stopPropagation();
          moveMeal(this);
        };
        mealItem.appendChild(moveBtn);

        (sortedIndex % 2 === 0 ? leftColumn : rightColumn).appendChild(mealItem);
      });

      list.appendChild(leftColumn);
      list.appendChild(rightColumn);
    }

    // 行動版：點擊某個「菜餚」方塊後，顯示選單
    function onMealItemClick(meal, mealItem) {
      // 如果螢幕寬度大於 768，就不彈出行動版選單
      if (window.innerWidth > 768) return;

      currentClickedMealName = meal;
      currentClickedMealItem = mealItem;
      document.getElementById('mobileMenuTitle').textContent = `「${meal}」操作選單`;
      document.getElementById('mobileMenu').style.display = 'block';
    }

    // 行動版選單：移動
    function onMobileMove() {
      if (!currentClickedMealName || !currentClickedMealItem) return;
      // 直接呼叫原本的移動函式
      moveMeal(currentClickedMealItem.querySelector('.move-btn'));
      closeMobileMenu();
    }

    // 行動版選單：刪除
    function onMobileDelete() {
      if (!currentClickedMealName || !currentClickedMealItem) return;
      // 在主清單其實沒有「刪除」功能(原本只在備用清單?), 
      // 若你想在主清單也能刪除，就可以自己寫 deleteMeal() 類似的函式。
      // 這裡示範最簡單：從 meals 中移除
      const index = meals.indexOf(currentClickedMealName);
      if (index !== -1) {
        meals.splice(index, 1);
        saveMeals();
        updateMealList();
        alert(`已刪除「${currentClickedMealName}」`);
      }
      closeMobileMenu();
    }

    // 新增：行動版選單 - 取消
    function closeMobileMenu() {
      document.getElementById('mobileMenu').style.display = 'none';
      currentClickedMealName = null;
      currentClickedMealItem = null;
    }

    // 更新備用菜餚清單
    function updateBackupList(newMeal = null) {
      const backupList = document.getElementById('backupList');
      backupList.innerHTML = '';

      movedMeals.forEach(meal => {
        const backupItem = document.createElement('div');
        backupItem.className = 'backup-item';
        backupItem.setAttribute('data-meal', meal);

        // 行動版：點擊整塊 => 顯示選單 (可做同樣彈窗處理)
        backupItem.onclick = function() {
          onBackupItemClick(meal, backupItem);
        };

        if (newMeal && meal === newMeal) {
          backupItem.classList.add('slide-in');
        }

        const mealNameSpan = document.createElement('span');
        mealNameSpan.textContent = meal;
        backupItem.appendChild(mealNameSpan);

        // 桌面版: 顯示「移動回來」與「刪除」按鈕
        const btnArea = document.createElement('div');
        btnArea.className = 'backup-btn-area';

        const moveBackBtn = document.createElement('button');
        moveBackBtn.className = 'move-btn';
        moveBackBtn.textContent = '移動';
        moveBackBtn.onclick = function(e) {
          e.stopPropagation();
          moveMealBack(meal, backupItem);
        };
        btnArea.appendChild(moveBackBtn);

        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-btn';
        deleteBtn.textContent = '刪除';
        deleteBtn.onclick = function(e) {
          e.stopPropagation();
          const confirmDelete = confirm(`確定要刪除「${meal}」嗎？`);
          if (confirmDelete) {
            deleteFromBackup(meal, backupItem);
          }
        };
        btnArea.appendChild(deleteBtn);

        backupItem.appendChild(btnArea);
        backupList.appendChild(backupItem);
      });
    }

    // 行動版：點擊某個「備用菜餚」方塊後，若也要彈出選單，可參考此做法
    function onBackupItemClick(meal, backupItem) {
      if (window.innerWidth > 768) return;
      // 類似 onMealItemClick 的做法，視需求實作
      currentClickedMealName = meal;
      currentClickedMealItem = backupItem;
      document.getElementById('mobileMenuTitle').textContent = `「${meal}」操作選單`;
      document.getElementById('mobileMenu').style.display = 'block';

      // 但備用清單的邏輯跟主清單不同，onMobileMove() 可能要改成 "移回主清單"
      // 或另外再寫一個 onMobileMoveBackup() ...
    }

    // 將菜餚移到備用區
    function moveMeal(btnElement) {
      const mealItem = btnElement.parentElement;
      const mealName = mealItem.getAttribute('data-meal');
      mealItem.classList.remove('slide-in');
      void mealItem.offsetWidth; // 觸發重繪
      mealItem.classList.add('slide-out');
      mealItem.addEventListener('animationend', function() {
        const index = meals.indexOf(mealName);
        if (index !== -1) {
          meals.splice(index, 1);
        }
        movedMeals.push(mealName);
        saveMeals();
        updateMealList();
        updateBackupList(mealName);
        alert(`已將「${mealName}」移至備用菜餚`);
      }, { once: true });
    }

    // 將菜餚從備用區移回主清單
    function moveMealBack(mealName, backupItem) {
      backupItem.classList.remove('slide-in');
      void backupItem.offsetWidth;
      backupItem.classList.add('slide-out');
      backupItem.addEventListener('animationend', function() {
        const index = movedMeals.indexOf(mealName);
        if (index !== -1) {
          movedMeals.splice(index, 1);
        }
        meals.push(mealName);
        saveMeals();
        updateMealList(mealName);
        updateBackupList();
        alert(`已將「${mealName}」移回主清單`);
      }, { once: true });
    }

    // 從備用區刪除菜餚
    function deleteFromBackup(mealName, backupItem) {
      backupItem.classList.remove('slide-in');
      void backupItem.offsetWidth;
      backupItem.classList.add('ash-out');
      backupItem.addEventListener('animationend', function() {
        const index = movedMeals.indexOf(mealName);
        if (index !== -1) {
          movedMeals.splice(index, 1);
          saveMeals();
          updateBackupList();
          alert(`已刪除「${mealName}」`);
        }
      }, { once: true });
    }

    // 抽選按鈕功能
    function pickRandom() {
      if (meals.length === 0) {
        alert('請先新增一些菜餚！');
        return;
      }
      const randomIndex = Math.floor(Math.random() * meals.length);
      const selectedMeal = meals[randomIndex];
      showMealResult(selectedMeal);
    }

    // 根據螢幕寬度選擇結果顯示方式：行動版用 alert，桌面版使用 modal
    function showMealResult(selectedMeal) {
      if (window.innerWidth <= 768) {
        alert(`今晚吃：${selectedMeal}`);
      } else {
        document.getElementById('modalMeal').textContent = selectedMeal;
        document.getElementById('mealModal').style.display = 'flex';
      }
    }

    // 關閉 modal 的函式
    function closeModal() {
      document.getElementById('mealModal').style.display = 'none';
    }
  </script>
</body>
</html>
